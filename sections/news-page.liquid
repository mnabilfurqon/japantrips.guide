{{ 'news-page.css' | asset_url | stylesheet_tag }}

<div
  class="news-page"
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
>
  <div class="news-header">
    <h1>{{ section.settings.title | default: 'News & Articles' }}</h1>
    <p>
      {{ section.settings.description | default: 'Explore our latest travel guides, tips, and stories about Japan' }}
    </p>
  </div>

  {% if section.settings.show_filters %}
    <div class="news-filters">
      <a href="{{ pages['news'].url }}" class="filter-btn {% unless request.path contains '?' %}active{% endunless %}">
        All
      </a>
      {% assign categories = section.settings.categories | split: ',' %}
      {% for cat in categories %}
        <a
          href="{{ pages['news'].url }}?category={{ cat | strip | handleize }}"
          class="filter-btn {% if request.query.category == cat | strip | handleize %}active{% endif %}"
        >
          {{ cat | strip }}
        </a>
      {% endfor %}
    </div>
  {% endif %}

  {% assign all_articles = pages | where: 'template_suffix', 'news-article' %}

  {% if request.query.category %}
    {% assign filtered_articles = '' | split: '' %}
    {% for article in all_articles %}
      {% assign article_category = article.metafields.custom.category | handleize %}
      {% if article_category == request.query.category %}
        {% assign filtered_articles = filtered_articles | push: article %}
      {% endif %}
    {% endfor %}
    {% assign display_articles = filtered_articles %}
  {% else %}
    {% assign display_articles = all_articles %}
  {% endif %}

  <div class="news-grid">
    {% for article in display_articles limit: 12 %}
      {% assign word_count = article.content | strip_html | number_of_words %}
      {% assign read_minutes = word_count | divided_by: 200 | at_least: 1 %}

      <a href="{{ article.url }}" class="news-card {% if forloop.first %}featured{% endif %}">
        <div class="news-card-image">
          {% if article.image %}
            {% if forloop.first %}
              <img
                srcset="
                  {{ article.image | image_url: width: 400 }} 400w,
                  {{ article.image | image_url: width: 600 }} 600w,
                  {{ article.image | image_url: width: 800 }} 800w,
                  {{ article.image | image_url: width: 1000 }} 1000w
                "
                sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 600px"
                src="{{ article.image | image_url: width: 800 }}"
                alt="{{ article.title }}"
                loading="eager"
                width="800"
                height="500"
              >
            {% else %}
              <img
                srcset="
                  {{ article.image | image_url: width: 300 }} 300w,
                  {{ article.image | image_url: width: 400 }} 400w,
                  {{ article.image | image_url: width: 600 }} 600w
                "
                sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 400px"
                src="{{ article.image | image_url: width: 400 }}"
                alt="{{ article.title }}"
                loading="lazy"
                width="400"
                height="300"
              >
            {% endif %}
          {% else %}
            <div style="background: var(--article-light-bg); width: 100%; height: 100%;"></div>
          {% endif %}
        </div>
        <div class="news-card-content">
          {% if article.metafields.custom.category %}
            <span class="news-card-category">{{ article.metafields.custom.category }}</span>
          {% endif %}
          <h2 class="news-card-title">{{ article.title }}</h2>
          {% if article.content %}
            {% assign excerpt = article.content | strip_html | truncate: 150 %}
            <p class="news-card-excerpt">{{ excerpt }}</p>
          {% endif %}
          <div class="news-card-meta">
            {% if article.metafields.custom.author %}
              <span>{{ article.metafields.custom.author }}</span>
            {% endif %}
            <span>{{ article.published_at | date: '%B %d, %Y' }}</span>
            <span>{{ read_minutes }} min read</span>
          </div>
        </div>
      </a>
    {% endfor %}
  </div>
</div>

{% schema %}
{
  "name": "News Page",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Page Title",
      "default": "News & Articles"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Page Description",
      "default": "Explore our latest travel guides, tips, and stories about Japan"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show Category Filters",
      "default": true
    },
    {
      "type": "text",
      "id": "categories",
      "label": "Categories (comma separated)",
      "default": "Itinerary, Travel Tips, Culture, Food & Drink",
      "info": "Example: Itinerary, Travel Tips, Culture"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 28
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 28
    }
  ],
  "presets": [
    {
      "name": "News Page"
    }
  ]
}
{% endschema %}
